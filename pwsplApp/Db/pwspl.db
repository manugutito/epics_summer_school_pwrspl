record(ai,"$(project):ps-avg")
{
    field(DESC,"Average")
    field(EGU,"A")
    field(VAL,"0")
    field(HIGH,"$(high)")
    field(HSV,"MINOR")
    field(HIHI,"$(hihi)")
    field(HHSV,"MAJOR")
    field(FLNK,"$(project):fanout")
}

record(ai,"$(project):ps-unb")
{
    field(DESC,"Unbalance")
    field(EGU,"A")
    field(VAL,"0")
    field(HIGH,"$(high)")
    field(HSV,"MINOR")
    field(HIHI,"$(hihi)")
    field(HHSV,"MAJOR")
    field(FLNK,"$(project):fanout")
}

record(fanout,"$(project):fanout")
{
    field(LNK0,"$(project):calc-ps1")
    field(LNK1,"$(project):calc-ps2")
}

record(calc,"$(project):calc-ps1")
{
    field(DESC,"Calculate PS1 SP")
    field(INPA,"$(project):ps-avg")
    field(INPB,"$(project):ps-unb")
    field(CALC,"INPA*(INPB+1)")
    field(FLNK,"$(project):ps1-sp")
}

record(calc,"$(project):calc-ps2")
{
    field(DESC,"Calculate PS2 SP")
    field(INPA,"$(project):ps-avg")
    field(INPB,"$(project):ps-unb")
    field(CALC,"INPA*(1-INPB)")
    field(FLNK,"$(project):ps2-sp")
}

record(ao,"$(project):ps1-sp")
{
    field(DESC,"Setpoint of PS1")
    field(EGU,"A")
    field(OMSL,"closed_loop")
    field(DOL,"$(project):calc-ps1")
}

record(ao,"$(project):ps2-sp")
{
    field(DESC,"Setpoint of PS2")
    field(EGU,"A")
    field(OMSL,"closed_loop")
    field(DOL,"$(project):calc-ps2")
}
