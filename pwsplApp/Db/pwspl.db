record(ai,"$(project):ps-avg")
{
    field(DESC,"Average")
    field(EGU,"A")
    field(VAL,"0")
    field(HIGH,"10")
    field(HSV,"MINOR")
    field(HIHI,"15")
    field(HHSV,"MAJOR")
    field(FLNK,"$(project):fanout-input")
}

record(ai,"$(project):ps-unb")
{
    field(DESC,"Unbalance")
    field(EGU,"A")
    field(VAL,"0")
    field(HIGH,"10")
    field(HSV,"MINOR")
    field(HIHI,"15")
    field(HHSV,"MAJOR")
    field(FLNK,"$(project):fanout-input")
}

record(fanout,"$(project):fanout-input")
{
    field(LNK0,"$(project):calc-ps1")
    field(LNK1,"$(project):calc-ps2")
}

record (bi,"$(project):disable")
{
    field (DESC, "Disable output")
    field(ZNAM,"Output ON")
    field(ONAM,"Output OFF")
    field(FLNK,"$(project):fanout-disable")
}

record(dfanout,"$(project):dfanout-disable")
{
    field(OUTA,"$(project):calc-ps1.DISA")
    field(OUTB,"$(project):calc-ps2.DISA")    
    field(OMSL,"closed_loop")
    field(DOL,"$(project):disable")
}

record(fanout,"$(project):fanout-disable")
{
    field(LNK0,"$(project):dfanout-disable")
    field(LNK1,"$(project):ps-avg")
    field(LNK2,"$(project):ps-unb")
}

record(calc,"$(project):calc-ps1")
{
    field(DESC,"Calculate PS1 SP")
    field(INPA,"$(project):ps-avg")
    field(INPB,"$(project):ps-unb")
    field(CALC,"A*(B+1)")
    field(FLNK,"$(project):ps1-sp")
}

record(calc,"$(project):calc-ps2")
{
    field(DESC,"Calculate PS2 SP")
    field(INPA,"$(project):ps-avg")
    field(INPB,"$(project):ps-unb")
    field(CALC,"A*(1-B)")
    field(FLNK,"$(project):ps2-sp")
}

record(ao,"$(project):ps1-sp")
{
    field(DESC,"Setpoint of PS1")
    field(EGU,"A")
    field(OMSL,"closed_loop")
    field(DOL,"$(project):calc-ps1")
}

record(ao,"$(project):ps2-sp")
{
    field(DESC,"Setpoint of PS2")
    field(EGU,"A")
    field(OMSL,"closed_loop")
    field(DOL,"$(project):calc-ps2")
}
